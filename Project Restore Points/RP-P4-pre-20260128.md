# Restore Point: RP-P4-pre-20260128

## Phase
**Pre-Phase 4 (Agenda & Case Management)**

## Timestamp
2026-01-28 (Pre-Implementation)

## State Summary

### Database State
| Component | Status |
|-----------|--------|
| Identity Tables | `app_user`, `app_role`, `user_role`, `super_admin_bootstrap` |
| Domain Tables | 10 tables with role-based RLS (Phase 3) |
| Workflow Helpers | `is_dossier_editable()`, `is_meeting_editable()`, `is_decision_draft()`, `is_task_assignee()` |
| Enums | 12 types deployed |
| Auth Functions | `get_user_roles()`, `has_role()`, `has_any_role()`, `is_super_admin()`, `get_current_user_id()` |

### Frontend State
| Component | Status |
|-----------|--------|
| Auth Integration | Supabase `signInWithPassword` wired |
| Dev Bypass Shim | RETIRED |
| RVM Menu | NOT implemented |
| RVM Pages | NOT implemented |
| Service Layer | NOT implemented |

### RLS Policies (Phase 3 Deployed)
- `rvm_dossier` — Role-based SELECT/INSERT/UPDATE
- `rvm_item` — Role-based SELECT/INSERT/UPDATE
- `rvm_meeting` — Role-based SELECT/INSERT/UPDATE
- `rvm_agenda_item` — Role-based SELECT/INSERT/UPDATE
- `rvm_decision` — Role-based SELECT/INSERT/UPDATE
- `rvm_document` — Role-based SELECT/INSERT/UPDATE
- `rvm_document_version` — Role-based SELECT/INSERT
- `rvm_task` — Role-based SELECT/INSERT/UPDATE
- `audit_event` — SELECT only (INSERT deferred to Phase 8)
- `missive_keyword` — Reference data with admin control

## Restore Instructions

### Database
Database state is at Phase 3 completion. No rollback required unless Phase 4 introduces unauthorized schema changes.

### Frontend
All frontend files are in Phase 3 state:
- `src/context/useAuthContext.tsx` — Supabase auth integration
- `src/app/(other)/auth/sign-in/useSignIn.ts` — signInWithPassword
- `src/types/auth.ts` — UserType with auth_id and roles
- `src/routes/router.tsx` — Auth loading states
- `src/assets/data/menu-items.ts` — Dashboard only

## Phase 4 Scope (Forward)
- Service layer (5 modules)
- React Query hooks (5 modules)
- RVM menu navigation
- RVM pages (Dossier, Meeting, Task)
- RVM components using Darkone patterns

## Verification
- [ ] Supabase sign-in functional
- [ ] Role-based RLS active
- [ ] No RVM menu items visible
- [ ] No RVM pages accessible

---

**Status:** LOCKED (Pre-Phase 4)
