# Restore Point: RP-P2B-post-20260128

## Phase Reference
- **Project:** AMS–RVM Core (v1)
- **Phase:** 2B (Core Domain — Data Model Only)
- **Type:** Post-Phase Completion
- **Created:** 2026-01-28

---

## Database State (After Phase 2B)

### Enums Deployed (12)
| Enum | Values |
|------|--------|
| `service_type` | proposal, missive |
| `proposal_subtype` | OPA, ORAG |
| `urgency_level` | regular, urgent, special |
| `dossier_status` | draft, registered, in_preparation, scheduled, decided, archived, cancelled |
| `meeting_type` | regular, urgent, special |
| `meeting_status` | draft, published, closed |
| `agenda_item_status` | scheduled, presented, withdrawn, moved |
| `decision_status` | approved, deferred, rejected, pending |
| `document_type` | proposal, missive, attachment, decision_list, minutes, other |
| `task_status` | todo, in_progress, blocked, done, cancelled |
| `task_priority` | normal, high, urgent |
| `task_type` | intake, dossier_management, agenda_prep, reporting, review, distribution, other |
| `confidentiality_level` | standard_confidential, restricted, highly_restricted |

### Tables Deployed (10 Domain + 4 Identity = 14 Total)
| Table | Purpose | RLS |
|-------|---------|-----|
| `missive_keyword` | Taxonomy reference data | Baseline (SELECT: all auth, others: super_admin) |
| `rvm_dossier` | Core dossier registry | Baseline (super_admin) |
| `rvm_item` | Dossier intake items | Baseline (super_admin) |
| `rvm_meeting` | Meeting registry | Baseline (super_admin) |
| `rvm_agenda_item` | Meeting agenda items | Baseline (super_admin) |
| `rvm_decision` | Decision records | Baseline (super_admin) |
| `rvm_document` | Document metadata | Baseline (super_admin) |
| `rvm_document_version` | Document versions | Baseline (super_admin, no UPDATE) |
| `rvm_task` | Task assignments | Baseline (super_admin) |
| `audit_event` | Audit log | Baseline (super_admin, no UPDATE/DELETE) |

### Functions Deployed (Phase 2B)
| Function | Purpose |
|----------|---------|
| `generate_dossier_number()` | Auto-generate RVM-YYYY-NNNNN format |

### Triggers Deployed (Data Generation Only)
| Trigger | Table | Purpose |
|---------|-------|---------|
| `trg_generate_dossier_number` | rvm_dossier | Auto-number on insert |
| `update_rvm_dossier_updated_at` | rvm_dossier | Timestamp maintenance |
| `update_rvm_decision_updated_at` | rvm_decision | Timestamp maintenance |
| `update_rvm_task_updated_at` | rvm_task | Timestamp maintenance |

### Indexes Deployed (13)
| Index | Table | Column(s) |
|-------|-------|-----------|
| `idx_dossier_status` | rvm_dossier | status |
| `idx_dossier_urgency` | rvm_dossier | urgency |
| `idx_dossier_created_at` | rvm_dossier | created_at DESC |
| `idx_task_dossier` | rvm_task | dossier_id |
| `idx_task_status` | rvm_task | status |
| `idx_task_due` | rvm_task | due_at (partial) |
| `idx_meeting_date` | rvm_meeting | meeting_date |
| `idx_agenda_meeting` | rvm_agenda_item | meeting_id |
| `idx_decision_final` | rvm_decision | is_final |
| `idx_audit_entity` | audit_event | entity_type, entity_id |
| `idx_audit_occurred` | audit_event | occurred_at DESC |
| `idx_document_dossier` | rvm_document | dossier_id |
| `idx_docversion_document` | rvm_document_version | document_id |

---

## Scope Compliance

### Implemented (DATA MODEL ONLY)
- ✅ 12 enum types
- ✅ 10 domain tables with FK relationships
- ✅ CHECK constraints (proposal_requires_subtype, missive_requires_keyword, in_progress_requires_user)
- ✅ Sequence for dossier numbering
- ✅ Data generation trigger (dossier_number)
- ✅ Timestamp maintenance triggers (updated_at)
- ✅ Baseline RLS (enable + super-admin bypass)
- ✅ Performance indexes

### Deferred (Per Scope Correction)
- ⏳ `prevent_decision_modification()` → Phase 5
- ⏳ `prevent_audit_modification()` → Phase 8
- ⏳ `prevent_audit_deletion()` → Phase 8
- ⏳ Full role-based RLS matrix → Phase 3+
- ⏳ Decision-state-dependent policies → Phase 5
- ⏳ Audit-readonly semantics → Phase 8

### Not Implemented (Forbidden)
- ❌ Workflow engines
- ❌ Approval logic
- ❌ UI components
- ❌ Authentication flows
- ❌ Background jobs
- ❌ Darkone template changes

---

## Codebase State
- No frontend changes made
- No UI modifications
- Darkone template parity: 1:1
- Dev bypass shim: Still active

---

## Recovery Instructions

To restore to this point:
1. Revert to this commit/version
2. Database schema matches this specification
3. Run verification queries below

### Verification Queries
```sql
-- Verify enums
SELECT typname FROM pg_type WHERE typnamespace = 'public'::regnamespace AND typtype = 'e';

-- Verify tables
SELECT tablename FROM pg_tables WHERE schemaname = 'public' ORDER BY tablename;

-- Verify RLS enabled
SELECT tablename, rowsecurity FROM pg_tables WHERE schemaname = 'public' AND rowsecurity = true;

-- Verify indexes
SELECT indexname FROM pg_indexes WHERE schemaname = 'public';
```

---

## Next Phase
Phase 3 (Workflow Engine) — Awaiting explicit authorization
